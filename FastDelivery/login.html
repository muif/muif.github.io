<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - FastDelivery</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Animated Background */
        .login-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(45deg, #4e54c8, #8f94fb);
            z-index: -1;
            overflow: hidden;
        }

        .shape {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: 50%;
            animation: float 20s infinite;
        }

        .shape:nth-child(1) { width: 200px; height: 200px; top: 10%; left: 10%; animation-delay: 0s; }
        .shape:nth-child(2) { width: 300px; height: 300px; bottom: 20%; right: 10%; animation-delay: -5s; }
        .shape:nth-child(3) { width: 150px; height: 150px; bottom: 10%; left: 30%; animation-delay: -10s; }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-50px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }

        /* Login Card Positioning */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-card {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.9);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            text-align: center;
        }

        .brand-logo {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .brand-text {
            color: var(--primary);
            font-weight: 800;
            margin-bottom: 2rem;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>

    <div class="login-bg">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="login-container">
        <div class="login-card fade-in">
            <div class="brand-logo">ğŸš€</div>
            <h1 class="brand-text">FastDelivery</h1>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username" style="text-align: right;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="username" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…..." required>
                </div>
                
                <div class="form-group">
                    <label for="password" style="text-align: right;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="password" class="form-control" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; margin-top: 1rem;">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>
            
            <p style="margin-top: 1.5rem; font-size: 0.8rem; color: #888;">
                Enterprise Edition v1.0 <br> Secure Access
            </p>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // 1. Check if already logged in
        if (Auth.getUser()) {
            redirectBasedOnRole(Auth.getUser().role);
        }

        // 2. Handle Login Submit
        const loginForm = document.getElementById('loginForm');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!username || !password) {
                UI.showToast("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");
                return;
            }

            try {
                // Call API
                const response = await Api.post('login', {
                    username: username,
                    password: password
                });

                // If success (Api class throws error if not success)
                Auth.login(response); // Save to Session
                UI.showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${response.full_name}`, "success");

                // Redirect after short delay
                setTimeout(() => {
                    redirectBasedOnRole(response.role);
                }, 1000);

            } catch (error) {
                console.error(error);
                // UI.showToast handles the error display inside Api class mostly, 
                // but we catch here just in case additional logic is needed.
            }
        });

        // 3. Routing Logic
        function redirectBasedOnRole(role) {
            switch(role) {
                case 'admin':
                    window.location.href = 'dashboard.html';
                    break;
                case 'seller':
                    window.location.href = 'seller.html';
                    break;
                case 'courier':
                    window.location.href = 'courier.html';
                    break;
                default:
                    UI.showToast("Ø¯ÙˆØ± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØŒ Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¯Ø¹Ù…", "error");
                    Auth.logout();
            }
        }
    </script>
</body>
</html>